<!DOCTYPE html>
<html>
<head>
    <title>Aprmoné¢†æ°´</title>
    <style>
        /* ä¸“ä¸šçº§æ ·å¼è®¾è®¡ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            background: #f5f6f8;
        }
        .control-panel {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }
        .status-panel {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            max-height: 400px;
            overflow-y: auto;
        }
        textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
        }
        .toolbar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .toolbar input {
            padding: 0.8rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover {
            background: #1d4ed8;
        }
        .log-entry {
            padding: 1rem;
            margin: 0.5rem 0;
            background: #f8fafc;
            border-radius: 6px;
            font-size: 0.9em;
        }
        .status-card {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin: 0.5rem 0;
            background: #f8fafc;
            border-radius: 6px;
            border-left: 4px solid #94a3b8;
        }
        .status-icon {
            font-size: 1.2em;
            margin-right: 1rem;
            min-width: 30px;
        }
        .success { border-color: #10b981; }
        .error { border-color: #ef4444; }
        .retry { border-color: #f59e0b; }
        
        /* æ–°å¢ç›‘æ§æ ·å¼ */
        .monitor-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            background: #f3f4f6;
            color: #6b7280;
        }
        .monitoring { background: #dbeafe; color: #1d4ed8; }
    </style>
</head>
<body>
    <!-- æ–°å¢ç›‘æ§é¢æ¿ -->
    <div class="control-panel">
        <h3>ğŸ”” ä½™é¢ç›‘æ§</h3>
        <div style="display: flex; gap: 15px; align-items: center; margin-top: 1rem;">
            <button onclick="monitor.toggle()" 
                    style="background: #10b981; padding: 0.8rem 1.5rem;">
                ğŸ•¹ï¸ ç›‘æ§å¼€å…³
            </button>
            <div style="display: flex; gap: 10px; align-items: center;">
                <span>çŠ¶æ€: <span id="monitorStatus" class="monitor-status">æœªå¯åŠ¨</span></span>
                <span>å½“å‰ä½™é¢: <span id="balanceDisplay" style="color:#3b82f6;font-weight:bold">0</span> MON</span>
            </div>
        </div>
        <audio id="alertSound" hidden>
            <source src="https://ting8.yymp3.com/new12/yidangnian/3.mp3" type="audio/mpeg">
        </audio>
    </div>
    <!-- é¢†æ°´æ§åˆ¶å° -->
    <div class="control-panel">
        <h2>ğŸš° é¢†æ°´æ§åˆ¶ç³»ç»Ÿ</h2>
        <textarea id="addresses" rows="8" placeholder="è¾“å…¥é’±åŒ…åœ°å€ (æ¯è¡Œä¸€ä¸ª)<åŠŸèƒ½åˆ—è¡¨ä¾æ¬¡ä¸ºå¹¶å‘æ•°/é‡è¯•æ¬¡æ•°/é‡è¯•é—´éš”>"></textarea>
        
        <div class="toolbar">
            <input type="number" id="concurrency" value="5" min="1" max="20" placeholder="å¹¶å‘æ•°">
            <input type="number" id="max-retries" value="3" min="0" placeholder="æœ€å¤§é‡è¯•">
            <input type="number" id="delay" value="5000" placeholder="é‡è¯•é—´éš”(ms)">
            <button onclick="startProcessing()">â–¶ï¸ å¼€å§‹å¯åŠ¨</button>
        </div>
    </div>


    <!-- çŠ¶æ€è¿½è¸ª -->
    <div class="status-panel">
        <h3>ğŸ“Š é¢†å–çŠ¶æ€</h3>
        <div id="status-container"></div>
    </div>

    <!-- ç³»ç»Ÿæ—¥å¿— -->
    <div class="status-panel">
        <h3>ğŸ“œ ç³»ç»Ÿæ—¥å¿—</h3>
        <div id="log-container"></div>
    </div>

<script>
// ================= åŸæœ‰é¢†æ°´ç³»ç»Ÿ =================
class FaucetSystem {
    constructor() {
        this.activeWorkers = new Set();
        this.statusMap = new Map();
    }

    generateUA() {
        const systems = [
            'Windows NT 10.0; Win64; x64',
            'X11; Linux x86_64',
            'iPhone; CPU iPhone OS 17_4_1 like Mac OS X',
            'Android 13; Pixel 6'
        ];
        
        const browserTemplates = [
            `Chrome/${Math.floor(100 + Math.random()*20)}.0.0.0`,
            `Firefox/${Math.floor(100 + Math.random()*20)}.0`,
            `Safari/${Math.floor(15 + Math.random()*5)}.${Math.floor(Math.random()*3)}`
        ];

        return `Mozilla/5.0 (${systems[Math.floor(Math.random()*systems.length)]}) AppleWebKit/537.36 (KHTML, like Gecko) ${browserTemplates[Math.floor(Math.random()*browserTemplates.length)]}`;
    }

    async claim(address, attempt = 0) {
        try {
            const response = await fetch('https://faucet-api.apr.io/api/claim', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'User-Agent': this.generateUA(),
                    'Origin': 'https://stake.apr.io',
                    'Referer': 'https://stake.apr.io/'
                },
                body: JSON.stringify({ address })
            });

            const data = await response.json();
            
            if (data.claim_id) {
                this.logSuccess(address, data.claim_id);
                return true;
            }
            
            if (data.message?.includes('rate limit')) {
                this.logRetry(address, attempt);
                return this.retry(address, attempt);
            }

            throw new Error(data.message || 'æœªçŸ¥é”™è¯¯');

        } catch (error) {
            this.logError(address, error);
            return this.retry(address, attempt);
        }
    }

    async retry(address, attempt) {
        const maxRetries = parseInt(document.getElementById('max-retries').value);
        const delay = parseInt(document.getElementById('delay').value);

        if (attempt < maxRetries) {
            this.updateStatus(address, 'retry', `ç­‰å¾…é‡è¯• (${attempt+1}/${maxRetries})`);
            await new Promise(resolve => setTimeout(resolve, delay));
            return this.claim(address, attempt + 1);
        }
        this.updateStatus(address, 'error', 'è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°');
        return false;
    }

    updateStatus(address, status, message) {
        const card = document.getElementById(`status-${address}`) || this.createStatusCard(address);
        card.className = `status-card ${status}`;
        card.innerHTML = `
            <div class="status-icon">${this.getStatusIcon(status)}</div>
            <div>
                <div><strong>${address}</strong></div>
                <div>çŠ¶æ€: ${this.getStatusText(status)}</div>
                <div style="color:#64748b;font-size:0.9em">${message}</div>
            </div>
        `;
        document.getElementById('status-container').prepend(card);
    }

    log(type, message) {
        const logEntry = document.createElement('div');
        logEntry.className = `log-entry ${type}`;
        logEntry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
        document.getElementById('log-container').appendChild(logEntry);
    }

    getStatusIcon(status) {
        return {
            success: 'âœ…',
            error: 'âŒ',
            retry: 'ğŸ”„'
        }[status] || 'â³';
    }

    getStatusText(status) {
        return {
            success: 'é¢†å–æˆåŠŸ',
            error: 'æ“ä½œå¤±è´¥',
            retry: 'é‡è¯•ä¸­'
        }[status] || 'ç­‰å¾…å¤„ç†';
    }

    createStatusCard(address) {
        const card = document.createElement('div');
        card.id = `status-${address}`;
        return card;
    }

    logSuccess(address, claimId) {
        this.log('success', `${address.slice(0,6)}...${address.slice(-4)} æˆåŠŸé¢†å–ï¼Œäº¤æ˜“ID: ${claimId}`);
    }

    logRetry(address, attempt) {
        this.log('warning', `${address.slice(0,6)}...${address.slice(-4)} ç¬¬${attempt+1}æ¬¡é‡è¯•`);
    }

    logError(address, error) {
        this.log('error', `${address.slice(0,6)}...${address.slice(-4)} é”™è¯¯: ${error.message}`);
    }
}

// ================= æ–°å¢ç›‘æ§ç³»ç»Ÿ =================
class MonitorSystem {
    constructor() {
        this.isActive = false;
        this.interval = null;
        this.audio = document.getElementById('alertSound');
        this.initAudioHandling();
    }

    initAudioHandling() {
        document.addEventListener('click', () => {
            this.audio.play().then(() => this.audio.pause());
        });
    }

    toggle() {
        this.isActive = !this.isActive;
        const statusElem = document.getElementById('monitorStatus');
        statusElem.textContent = this.isActive ? 'ç›‘æ§ä¸­' : 'æœªå¯åŠ¨';
        statusElem.className = `monitor-status${this.isActive ? ' monitoring' : ''}`;

        if (this.isActive) {
            this.interval = setInterval(() => this.checkBalance(), 5000);
            this.checkBalance();
        } else {
            clearInterval(this.interval);
            this.audio.pause();
        }
    }

    async checkBalance() {
        try {
            const response = await fetch('https://faucet-api.apr.io/api/capacity', {
                headers: { 
                    'User-Agent': new FaucetSystem().generateUA(),
                    'Referer': 'https://stake.apr.io/' 
                }
            });
            const data = await response.json();
            
            document.getElementById('balanceDisplay').textContent = data.amountLeft;
            
            if (data.amountLeft > 0) {
                this.triggerAlert();
                this.logToSystem(`æ£€æµ‹åˆ°å¯ç”¨ä½™é¢: ${data.amountLeft} MON`);
            }
        } catch (error) {
            this.logToSystem(`ç›‘æ§è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        }
    }

    triggerAlert() {
        this.audio.play().catch(() => {
            this.logToSystem('å£°éŸ³æ’­æ”¾è¢«é˜»æ­¢ï¼Œè¯·ç‚¹å‡»é¡µé¢æˆæƒ', 'warning');
        });
    }

    logToSystem(message, type = 'info') {
        const logEntry = document.createElement('div');
        logEntry.className = `log-entry ${type}`;
        logEntry.innerHTML = `[${new Date().toLocaleTimeString()}] ğŸ”” ${message}`;
        document.getElementById('log-container').appendChild(logEntry);
    }
}

// ================= ç³»ç»Ÿåˆå§‹åŒ– =================
const faucet = new FaucetSystem();
const monitor = new MonitorSystem();

function startProcessing() {
    const addresses = document.getElementById('addresses').value.split('\n').filter(a => a.trim());
    const concurrency = parseInt(document.getElementById('concurrency').value);

    const worker = async (queue) => {
        while(queue.length > 0) {
            const address = queue.pop();
            await faucet.claim(address);
        }
    };

    const queue = [...addresses];
    Array.from({ length: concurrency }).forEach(() => worker(queue));
}
</script>
</body>
</html>